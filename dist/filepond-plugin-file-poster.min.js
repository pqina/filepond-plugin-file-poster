/*
 * FilePondPluginFilePoster 1.1.1
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */

/* eslint-disable */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginFilePoster=t()}(this,function(){"use strict";var c={type:"spring",stiffness:.5,damping:.45,mass:10},p=function(e){return-.5*(Math.cos(Math.PI*e)-1)},u=function(e,t){return Math.floor(Math.sqrt(e/(t/4)))},e=function(e,t,a,i,r){e.width=t,e.height=a;var o=e.getContext("2d"),n=.5*t,c=o.createRadialGradient(n,a+110,a-100,n,a+110,a+100);!function(e,t){for(var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:p,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:10,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,n=1-o,c=t.join(","),d=0;d<=r;d++){var l=d/r,s=o+n*l;e.addColorStop(s,"rgba("+c+", "+i(l)*a+")")}}(c,i,r,void 0,8,.4),o.save(),o.translate(.5*-t,0),o.scale(2,1),o.fillStyle=c,o.fillRect(0,0,t,a),o.restore()},t="undefined"!=typeof navigator,d=t&&document.createElement("canvas"),l=t&&document.createElement("canvas"),s=t&&document.createElement("canvas");t&&(e(d,500,200,[40,40,40],.85),e(l,500,200,[196,78,71],1),e(s,500,200,[54,151,99],1));var r=function(o){var n=o.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:function(e){var t,a,i=e.root,r=e.props;t=r.template,(a=i.element).width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),e=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},t=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1};return o.utils.createView({name:"file-poster-wrapper",create:function(e){var t,a=e.root,i=e.props,r=(t=o).utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:function(e){var t=e.root;t.ref.image=document.createElement("img"),t.element.appendChild(t.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:function(e){var t=e.root,a=e.props,i=a.id,r=t.query("GET_ITEM",{id:a.id});if(r){var o=r.getMetadata("poster");t.ref.image.src=o,t.dispatch("DID_FILE_POSTER_DRAW",{id:i})}}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:c,scaleY:c,opacity:{type:"tween",duration:750}}}});a.ref.image=a.appendChildView(a.createChildView(r,{id:i.id,scaleX:1.25,scaleY:1.25,opacity:0})),a.ref.overlayShadow=a.appendChildView(a.createChildView(n,{template:d,opacity:0})),a.ref.overlaySuccess=a.appendChildView(a.createChildView(n,{template:s,opacity:0})),a.ref.overlayError=a.appendChildView(a.createChildView(n,{template:l,opacity:0}))},write:o.utils.createRoute({DID_FILE_POSTER_LOAD:function(e){e.root.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:function(e){var t=e.root.ref.image;t.scaleX=1,t.scaleY=1,t.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:function(e){var a=e.root,r=e.props.id,i=a.query("GET_ITEM",r);if(i){var t,o,n,c=i.getMetadata("poster"),d=function(e){var t=function(e){var t=Math.min(10/e.width,10/e.height),a=document.createElement("canvas"),i=a.getContext("2d"),r=a.width=Math.ceil(e.width*t),o=a.height=Math.ceil(e.height*t);i.drawImage(e,0,0,r,o);var n=null;try{n=i.getImageData(0,0,r,o).data}catch(e){return null}for(var c=n.length,d=0,l=0,s=0,p=0;p<c;p+=4)d+=n[p]*n[p],l+=n[p+1]*n[p+1],s+=n[p+2]*n[p+2];return{r:d=u(d,c),g:l=u(l,c),b:s=u(s,c)}}(e);i.setMetadata("color",t),a.dispatch("DID_FILE_POSTER_LOAD",{id:r,data:e})};t=c,o=function(e,t){var i;a.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:r,width:e,height:t}),(i=c,new Promise(function(e,t){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){e(a)},a.onerror=function(e){t(e)},a.src=i})).then(d)},(n=new Image).onload=function(){var e=n.naturalWidth,t=n.naturalHeight;n=null,o(e,t)},n.src=t}},DID_THROW_ITEM_LOAD_ERROR:t,DID_THROW_ITEM_PROCESSING_ERROR:t,DID_THROW_ITEM_INVALID:t,DID_COMPLETE_ITEM_PROCESSING:function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:e,DID_REVERT_ITEM_PROCESSING:e})})},a=function(e){var t=e.addFilter,a=e.utils,i=a.Type,n=a.createRoute,c=r(e);return t("CREATE_VIEW",function(e){var t=e.is,r=e.view,o=e.query;if(t("file")&&o("GET_ALLOW_FILE_POSTER")){r.registerWriter(n({DID_LOAD_ITEM:function(e){var t=e.root,a=e.props.id,i=o("GET_ITEM",a);i&&i.getMetadata("poster")&&!i.archived&&(t.ref.imagePreview=r.appendChildView(r.createChildView(c,{id:a})),t.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:a}))},DID_FILE_POSTER_CALCULATE_SIZE:function(e){var t=e.root,a=(e.props,e.action),i=t.rect.element.width*(a.height/a.width);t.ref.imagePreview.element.style.cssText="height:"+Math.round(i)+"px"}}))}}),{options:{allowFilePoster:[!0,i.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:a})),a});